<% @page_title = "Webhooks" %>

<% content_for :header do %>
  <%= render "filters/menu", user_filtering: @user_filtering %>
  <div class="header__actions header__actions--start">
    <%= link_to cards_path(collection_ids: [ @collection ]), class: "btn borderless txt-medium", data: { controller: "hotkey", action: "keydown.esc@document->hotkey#click" } do %>
      <span class="overflow-ellipsis">
        &larr;
        <strong><%= @collection.name %></strong>
      </span>
    <% end %>
  </div>

  <h1 class="header__title"><%= @page_title %></h1>

  <div class="header__actions header__actions--end">
    <%= link_to new_collection_webhook_path, class: "btn" do %>
      <%= icon_tag "add" %>
      <span class="for-screen-reader">Create a new webhook</span>
    <% end %>
  </div>
<% end %>

<%= tag.section class: "panel shadow center webhooks", data: {
  controller: "navigable-list",
  action: "keydown->navigable-list#navigate",
  navigable_list_focus_on_selection_value: true,
  navigable_list_actionable_items_value: true
} do %>
  <% if @page.records.any? %>
    <ul class="flex flex-column align-start gap margin-none unpad" data-filter-target="list">
      <%= render partial: "webhooks/webhook", collection: @page.records %>
    </ul>
  <% else %>
    <p>Webhooks can notify another application when something happens in this Fizzy collection. You'll choose which events to subscribe to and provide a URL to receive the data.</p>
    <p>For example, you could create a webhook that posts to a Campfire chat in Basecamp when new cards are added to Fizzy.</p>
    <%= link_to new_collection_webhook_path, class: "btn btn--link" do %>
      <%= icon_tag "add" %>
      <span>Set up a webhook</span>
    <% end %>
  <% end %>

  <% if @page.records.many? %>
    <footer class="popup__footer">
      Press <kbd class="kbd">↑</kbd><kbd class="kbd">↓</kbd> to move, <kbd class="kbd">enter</kbd> to visit webhook, <kbd class="kbd">SHIFT+ENTER</kbd> to toggle.
    </footer>
  <% end %>
<% end %>
